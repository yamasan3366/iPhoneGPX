<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>iPhoneGPX</title>
    <base href="/iPhoneGPX/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="iPhoneGPX.styles.css" rel="stylesheet" />
    <link href="manifest.webmanifest" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map, marker, polyline;
        // åœ°å›³ã®åˆæœŸåŒ–
        window.initMap = () => {
            map = L.map('map').setView([35.68, 139.76], 13);
            L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
                attribution: 'å›½åœŸåœ°ç†é™¢'
            }).addTo(map);
            marker = L.marker([0, 0]).addTo(map); // ç¾åœ¨åœ°ç”¨
        };

        // GPSç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦åœ°å›³ã‚’æ›´æ–°
        window.getLocation = (dotnetHelper) => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    marker.setLatLng([lat, lon]);
                    map.setView([lat, lon]);
                });
            }
        };

        // GPXè»Œè·¡ã®æç”»
        window.drawTrack = (points) => {
            if (polyline) map.removeLayer(polyline);
            polyline = L.polyline(points.map(p => [p.lat, p.lon]), { color: 'red' }).addTo(map);
            map.fitBounds(polyline.getBounds());
        };
    </script>

</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
</body>

</html>
